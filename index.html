<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart Auto Image Editor Tool</title>

<style>
body{
  font-family:'Segoe UI',system-ui,sans-serif;
  background:#f0f2f5;
  margin:0;
  padding:24px;
  color:#111827
}
h1{font-size:2rem;margin-bottom:4px}
p{color:#6b7280;margin-bottom:20px}
.container{display:grid;grid-template-columns:1fr 360px;gap:24px}
.panel{
  background:#fff;
  border-radius:16px;
  padding:24px;
  box-shadow:0 8px 24px rgba(0,0,0,.08);
  border:1px solid #e5e7eb
}
.upload{
  border:2px dashed #d1d5db;
  padding:40px;
  text-align:center;
  border-radius:12px;
  cursor:pointer;
  transition:.2s
}
.upload.dragover{
  background:#eef2ff;
  border-color:#6366f1
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
  gap:16px;
  margin-top:16px
}
.thumb{
  background:#fff;
  border-radius:12px;
  padding:6px;
  position:relative;
  border:1px solid #e5e7eb
}
.thumb button{
  position:absolute;
  top:4px;
  right:4px;
  background:#ef4444;
  color:#fff;
  border:none;
  border-radius:6px;
  cursor:pointer
}
canvas{
  width:100%;
  border-radius:8px;
  display:block;
  background:repeating-conic-gradient(#ccc 0% 25%,#fff 0% 50%) 50%/20px 20px
}
label{font-weight:600;display:block;margin-top:14px}
input{width:100%;margin-top:6px}
.toggle{display:flex;gap:8px;margin-top:12px}
.progress{height:8px;background:#e5e7eb;border-radius:999px;overflow:hidden;margin-top:12px}
.progress div{height:100%;width:0%;background:#6366f1}
button.main{
  margin-top:16px;
  width:100%;
  padding:14px;
  font-weight:600;
  background:linear-gradient(90deg,#6366f1,#818cf8);
  color:#fff;
  border-radius:10px;
  border:none;
  cursor:pointer
}
</style>
</head>

<body>
<h1>Smart Auto Image Editor Tool</h1>
<p>Automatically removes background, centers content, applies clean outlines, and optionally adds a rainbow overlay.</p>

<div class="container">
<div class="panel">
  <div class="upload" id="dropZone">
    <strong>Drop images or click</strong><br>
    <small>PNG, JPG, WEBP</small>
    <input type="file" id="fileInput" hidden multiple accept="image/*">
  </div>
  <div class="grid" id="grid"></div>
</div>

<div class="panel">
  <label>Outline Width (px)</label>
  <input type="number" id="width" value="25" min="1" max="150">

  <label>Outline Color</label>
  <input type="color" id="color" value="#000000">

  <div class="toggle">
    <input type="checkbox" id="removeBg" checked>
    <label for="removeBg">Remove background</label>
  </div>

  <div class="toggle">
    <input type="checkbox" id="cropEnabled" checked>
    <label for="cropEnabled">Auto-crop & center</label>
  </div>

  <div class="toggle">
    <input type="checkbox" id="checkerboard" checked>
    <label for="checkerboard">Transparency preview</label>
  </div>

  <div class="toggle">
    <input type="checkbox" id="rainbowIcon">
    <label for="rainbowIcon">Apply Rainbow Icon</label>
  </div>

  <div class="progress"><div id="progress"></div></div>
  <button class="main" id="download">Download All Images</button>
</div>
</div>

<script>
const grid=document.getElementById('grid');
const dropZone=document.getElementById('dropZone');
const fileInput=document.getElementById('fileInput');
const progress=document.getElementById('progress');
const outlineWidth=document.getElementById('width');
const outlineColor=document.getElementById('color');
const removeBg=document.getElementById('removeBg');
const cropEnabled=document.getElementById('cropEnabled');
const checkerboard=document.getElementById('checkerboard');
const rainbowIcon=document.getElementById('rainbowIcon');

let items=new Map(),token=0;

/* ---------- WORKER ---------- */
const worker=new Worker(URL.createObjectURL(new Blob([`
self.onmessage = async e => {
  const { file, id, width, color, removeBg, cropEnabled, rainbow, token } = e.data;
  const img = await createImageBitmap(file);
  const w = img.width, h = img.height;

  const base = new OffscreenCanvas(w, h);
  const ctx = base.getContext('2d');
  ctx.drawImage(img, 0, 0);

  /* REMOVE BACKGROUND */
  if (removeBg) {
    const data = ctx.getImageData(0, 0, w, h);
    for (let i = 0; i < data.data.length; i += 4)
      if (data.data[i + 3] < 10) data.data[i + 3] = 0;
    ctx.putImageData(data, 0, 0);
  }

  /* AUTO CROP + CENTER */
  let minX = w, minY = h, maxX = 0, maxY = 0;
  if (cropEnabled) {
    const d = ctx.getImageData(0, 0, w, h).data;
    for (let y = 0; y < h; y++) for (let x = 0; x < w; x++)
      if (d[(y * w + x) * 4 + 3] > 0) {
        minX = Math.min(minX, x);
        minY = Math.min(minY, y);
        maxX = Math.max(maxX, x);
        maxY = Math.max(maxY, y);
      }
  }
  if (maxX < minX) { minX = 0; minY = 0; maxX = w - 1; maxY = h - 1; }

  const cw = maxX - minX + 1, ch = maxY - minY + 1;
  const pad = width;

  const out = new OffscreenCanvas(cw + pad * 2, ch + pad * 2);
  const octx = out.getContext('2d');

  const tmp = new OffscreenCanvas(cw, ch);
  tmp.getContext('2d').drawImage(base, minX, minY, cw, ch, 0, 0, cw, ch);

  /* OUTLINE */
  for (let y = -pad; y <= pad; y++)
    for (let x = -pad; x <= pad; x++)
      if (x*x + y*y <= pad*pad)
        octx.drawImage(tmp, pad + x, pad + y);

  octx.globalCompositeOperation = 'source-in';
  octx.fillStyle = color;
  octx.fillRect(0, 0, out.width, out.height);
  octx.globalCompositeOperation = 'source-over';
  octx.drawImage(tmp, pad, pad);

  /* RAINBOW ICON */
  if (rainbow) {
    const rainbowBitmap = await createImageBitmap(await fetch('Rainbow Overlay.png').then(r => r.blob()));
    const overlay = new OffscreenCanvas(cw, ch);
    const octx2 = overlay.getContext('2d');
    octx2.drawImage(tmp, 0, 0); // get alpha from original
    const alphaData = octx2.getImageData(0, 0, cw, ch);

    const rainbowCtx = overlay.getContext('2d');
    rainbowCtx.drawImage(rainbowBitmap, 0, 0, cw, ch);

    const rainbowData = rainbowCtx.getImageData(0, 0, cw, ch);
    for (let i = 0; i < alphaData.data.length; i += 4) {
      rainbowData.data[i + 3] = alphaData.data[i + 3]; // preserve original alpha
    }
    rainbowCtx.putImageData(rainbowData, 0, 0);

    octx.drawImage(overlay, pad, pad);
  }

  const blob = await out.convertToBlob({ type: 'image/png' });
  self.postMessage({ id, blob, token });
};
`],{type:'application/javascript'})));

/* ---------- UPLOAD ---------- */
dropZone.onclick=()=>fileInput.click();
dropZone.ondragover=e=>{e.preventDefault();dropZone.classList.add('dragover');};
dropZone.ondragleave=()=>dropZone.classList.remove('dragover');
dropZone.ondrop=e=>{
  e.preventDefault();dropZone.classList.remove('dragover');
  handleFiles(e.dataTransfer.files);
};
fileInput.onchange=()=>handleFiles(fileInput.files);

function handleFiles(files){
[...files].forEach(file=>{
  const id=crypto.randomUUID();
  const canvas=document.createElement('canvas');
  const wrap=document.createElement('div');
  wrap.className='thumb';
  const b=document.createElement('button');
  b.textContent='Ã—';
  b.onclick=()=>{items.delete(id);wrap.remove();render();};
  wrap.append(b,canvas);
  grid.appendChild(wrap);
  items.set(id,{file,canvas});
});
render();
}

/* ---------- RENDER ---------- */
[outlineWidth,outlineColor,removeBg,cropEnabled,checkerboard,rainbowIcon].forEach(i=>i.oninput=render);

function render(){
token++;let done=0;
progress.style.width='0%';
items.forEach((item,id)=>{
worker.postMessage({
  id, token, file:item.file,
  width:+outlineWidth.value,
  color:outlineColor.value,
  removeBg:removeBg.checked,
  cropEnabled:cropEnabled.checked,
  rainbow: rainbowIcon.checked
});
});
worker.onmessage=e=>{
if(e.data.token!==token)return;
const item=items.get(e.data.id);
const img=new Image();
img.onload=()=>{
  item.canvas.width=img.width;
  item.canvas.height=img.height;
  item.canvas.getContext('2d').drawImage(img,0,0);
  done++;
  progress.style.width=(done/items.size*100)+'%';
};
img.src=URL.createObjectURL(e.data.blob);
};
}

/* ---------- DOWNLOAD ---------- */
document.getElementById('download').onclick=()=>{
items.forEach(item=>{
const a=document.createElement('a');
a.href=item.canvas.toDataURL('image/png');
a.download=item.file.name.replace(/\..+$/,'')+'_outlined.png';
a.click();
});
};
</script>
</body>
</html>
