<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Image Outline Generator - Multiple Images</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f4f6f8; margin:0; padding:20px; }
    h1 { margin-bottom: 5px; }
    p { margin-top:0; color:#555; }
    .container { display:flex; gap:20px; flex-wrap:wrap; align-items:flex-start; }
    .panel { background:white; padding:15px; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,0.1); }
    canvas { background: repeating-conic-gradient(#eee 0% 25%, #ddd 0% 50%) 50% / 20px 20px; border-radius:6px; max-width:100%; height:auto; }
    label { display:block; margin-top:12px; font-weight:bold; }
    input[type=number], input[type=color] { width:100%; padding:6px; margin-top:4px; }
    button { margin-top:14px; padding:10px 14px; font-weight:bold; cursor:pointer; border-radius:6px; border:none; background:#4f46e5; color:white; }
    button:hover { background:#4338ca; }
    .checkbox { margin-top:10px; font-weight:normal; }
    .image-wrapper { margin-bottom:20px; }
  </style>
</head>
<body>

<h1>Image Outline Generator</h1>
<p>Upload multiple images. Add clean outlines. Download as PNG.</p>

<div class="panel">
  <input type="file" id="fileInput" accept="image/*" multiple />
</div>

<div id="imageContainer"></div>

<div class="panel" style="min-width:260px;">
  <h3>Tool Options</h3>

  <label>Outline Width (px)</label>
  <input type="number" id="outlineWidth" value="25" min="1" max="150" />

  <label>Outline Color</label>
  <input type="color" id="outlineColor" value="#000000" />

  <label class="checkbox">
    <input type="checkbox" id="edgeSmoothing" checked /> Enable Edge Smoothing
  </label>

  <button id="downloadAllBtn">Download All as ZIP</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script>
const fileInput = document.getElementById('fileInput');
const imageContainer = document.getElementById('imageContainer');
const outlineWidth = document.getElementById('outlineWidth');
const outlineColor = document.getElementById('outlineColor');
const edgeSmoothing = document.getElementById('edgeSmoothing');
const downloadAllBtn = document.getElementById('downloadAllBtn');

let images = [];

fileInput.addEventListener('change', () => {
  imageContainer.innerHTML = '';
  images = [];

  Array.from(fileInput.files).forEach(file => {
    const reader = new FileReader();
    reader.onload = () => {
      const img = new Image();
      img.onload = () => {
        const wrapper = document.createElement('div');
        wrapper.className = 'image-wrapper';

        const inputCanvas = document.createElement('canvas');
        const outputCanvas = document.createElement('canvas');
        const applyBtn = document.createElement('button');
        applyBtn.textContent = 'Apply Outline';
        const downloadBtn = document.createElement('button');
        downloadBtn.textContent = 'Download PNG';
        downloadBtn.style.backgroundColor = '#16a34a';
        downloadBtn.style.marginLeft = '10px';

        // Draw original image in inputCanvas
        inputCanvas.width = img.width;
        inputCanvas.height = img.height;
        inputCanvas.getContext('2d').drawImage(img,0,0);

        wrapper.appendChild(inputCanvas);
        wrapper.appendChild(outputCanvas);
        wrapper.appendChild(applyBtn);
        wrapper.appendChild(downloadBtn);
        imageContainer.appendChild(wrapper);

        const imageObj = { img, inputCanvas, outputCanvas };
        images.push(imageObj);

        // Apply outline
        applyBtn.addEventListener('click', () => applyOutline(imageObj));
        downloadBtn.addEventListener('click', () => {
          const a = document.createElement('a');
          a.download = 'outlined.png';
          a.href = outputCanvas.toDataURL('image/png');
          a.click();
        });

        // Live update when options change
        [outlineWidth, outlineColor, edgeSmoothing].forEach(el => {
          el.addEventListener('input', () => applyOutline(imageObj));
        });

        // Initial apply
        applyOutline(imageObj);
      };
      img.src = reader.result;
    };
    reader.readAsDataURL(file);
  });
});

function applyOutline(imageObj) {
  const { img, outputCanvas } = imageObj;
  const width = parseInt(outlineWidth.value, 10);
  const color = outlineColor.value;
  const smooth = edgeSmoothing.checked;
  const pad = width + 2;

  outputCanvas.width = img.width + pad*2;
  outputCanvas.height = img.height + pad*2;
  const ctx = outputCanvas.getContext('2d');
  ctx.clearRect(0,0,outputCanvas.width,outputCanvas.height);

  // Temporary canvas for alpha expansion
  const temp = document.createElement('canvas');
  temp.width = outputCanvas.width;
  temp.height = outputCanvas.height;
  const tctx = temp.getContext('2d');
  tctx.drawImage(img,pad,pad);

  for(let y=-width;y<=width;y++){
    for(let x=-width;x<=width;x++){
      if(x*x + y*y <= width*width){
        ctx.drawImage(temp,x,y);
      }
    }
  }

  if(smooth){
    ctx.filter = 'blur(1.5px)';
    ctx.drawImage(outputCanvas,0,0);
    ctx.filter = 'none';
  }

  ctx.globalCompositeOperation = 'source-in';
  ctx.fillStyle = color;
  ctx.fillRect(0,0,outputCanvas.width,outputCanvas.height);

  ctx.globalCompositeOperation = 'source-over';
  ctx.drawImage(img,pad,pad);
}

// Download all images as ZIP
downloadAllBtn.addEventListener('click', async () => {
  if(!images.length) return;
  const zip = new JSZip();
  images.forEach((imageObj,index)=>{
    const data = imageObj.outputCanvas.toDataURL('image/png').split(',')[1];
    zip.file('outlined_'+(index+1)+'.png', data, {base64:true});
  });
  const blob = await zip.generateAsync({type:'blob'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'outlined_images.zip';
  document.body.appendChild(a);
  a.click();
  a.remove();
});
</script>

</body>
</html>
