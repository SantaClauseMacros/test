<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart Auto Image Editor PRO</title>
<style>
body{
  font-family:'Segoe UI',system-ui;
  background:linear-gradient(135deg,#1e293b,#0f172a);
  margin:0;
  padding:30px;
  color:white;
}
h1{margin:0 0 6px 0}
p{opacity:.7;margin:0 0 25px 0}

.container{
  display:grid;
  grid-template-columns:1fr 420px;
  gap:24px;
}

.panel{
  background:rgba(255,255,255,.05);
  backdrop-filter:blur(20px);
  border:1px solid rgba(255,255,255,.1);
  border-radius:20px;
  padding:24px;
}

.upload{
  border:2px dashed rgba(255,255,255,.2);
  padding:60px;
  text-align:center;
  border-radius:16px;
  cursor:pointer;
  transition:.2s;
}
.upload:hover{
  background:rgba(255,255,255,.05);
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
  gap:18px;
  margin-top:18px;
}

.thumb{
  background:#111827;
  border-radius:14px;
  padding:6px;
  position:relative;
}

.thumb button{
  position:absolute;
  top:4px;
  right:4px;
  background:#ef4444;
  border:none;
  color:white;
  border-radius:6px;
  cursor:pointer;
}

canvas{
  width:100%;
  border-radius:12px;
  display:block;
  background:repeating-conic-gradient(#555 0% 25%,#222 0% 50%) 50%/20px 20px;
}

label{display:block;margin-top:14px;font-size:.9rem;opacity:.8}
input,select{width:100%;margin-top:6px}

button.main{
  margin-top:20px;
  width:100%;
  padding:14px;
  font-weight:600;
  background:linear-gradient(90deg,#6366f1,#9333ea);
  border:none;
  border-radius:12px;
  color:white;
  cursor:pointer;
}
</style>
</head>
<body>

<h1>Smart Auto Image Editor PRO</h1>
<p>Advanced icon processor with smart background removal & effects</p>

<div class="container">

<div class="panel">
  <div class="upload" id="dropZone">
    Drop images or click
    <input type="file" id="fileInput" hidden multiple accept="image/*">
  </div>
  <div class="grid" id="grid"></div>
</div>

<div class="panel">

<label>Output Size</label>
<input type="number" id="outputSize" value="512" min="32" max="2048">

<label>Padding</label>
<input type="range" id="padding" min="0" max="200" value="20">

<label>Background Tolerance</label>
<input type="range" id="tolerance" min="5" max="80" value="25">

<label>Outline Width</label>
<input type="number" id="outlineWidth" value="0" min="0" max="150">

<label>Outline Color</label>
<input type="color" id="outlineColor" value="#000000">

<label>Glow Radius</label>
<input type="number" id="glowRadius" value="0" min="0" max="200">

<label>Glow Color</label>
<input type="color" id="glowColor" value="#ffffff">

<label>Shadow X Offset</label>
<input type="number" id="shadowX" value="0">

<label>Shadow Y Offset</label>
<input type="number" id="shadowY" value="0">

<label>Shadow Blur</label>
<input type="number" id="shadowBlur" value="0">

<label>Shadow Opacity (0-1)</label>
<input type="number" id="shadowOpacity" value="0.5" step="0.1" min="0" max="1">

<label>Rounded Corners</label>
<input type="number" id="radius" value="0">

<label>Background Fill</label>
<input type="color" id="bgFill" value="#000000">

<label>
<input type="checkbox" id="removeBg" checked> Remove Background
</label>

<label>
<input type="checkbox" id="applyOutline"> Apply Outline
</label>

<label>
<input type="checkbox" id="rainbow"> Rainbow Overlay
</label>

<button class="main" id="download">Download All Sizes</button>

</div>
</div>

<script>
const grid = document.getElementById("grid");
const dropZone = document.getElementById("dropZone");
const fileInput = document.getElementById("fileInput");
const items = new Map();

dropZone.onclick=()=>fileInput.click();
fileInput.onchange=e=>handleFiles(e.target.files);
dropZone.ondragover=e=>{e.preventDefault();}
dropZone.ondrop=e=>{
  e.preventDefault();
  handleFiles(e.dataTransfer.files);
}

function handleFiles(files){
  [...files].forEach(file=>{
    const id=crypto.randomUUID();
    const canvas=document.createElement("canvas");
    const wrap=document.createElement("div");
    wrap.className="thumb";
    const b=document.createElement("button");
    b.textContent="Ã—";
    b.onclick=()=>{items.delete(id);wrap.remove();}
    wrap.append(b,canvas);
    grid.appendChild(wrap);
    items.set(id,{file,canvas});
    processImage(id);
  });
}

async function processImage(id){
  const item=items.get(id);
  const img=await createImageBitmap(item.file);

  const size=+outputSize.value;
  const canvas=item.canvas;
  canvas.width=size;
  canvas.height=size;
  const ctx=canvas.getContext("2d");

  ctx.clearRect(0,0,size,size);

  const temp=document.createElement("canvas");
  temp.width=img.width;
  temp.height=img.height;
  const tctx=temp.getContext("2d");
  tctx.drawImage(img,0,0);

  if(removeBg.checked){
    const d=tctx.getImageData(0,0,temp.width,temp.height);
    const data=d.data;
    const r0=data[0],g0=data[1],b0=data[2];
    const tol=+tolerance.value;
    for(let i=0;i<data.length;i+=4){
      if(Math.abs(data[i]-r0)<tol &&
         Math.abs(data[i+1]-g0)<tol &&
         Math.abs(data[i+2]-b0)<tol){
        data[i+3]=0;
      }
    }
    tctx.putImageData(d,0,0);
  }

  const scale=Math.min(size/img.width,size/img.height);
  const nw=img.width*scale;
  const nh=img.height*scale;
  const x=(size-nw)/2;
  const y=(size-nh)/2;

  ctx.save();

  if(+radius.value>0){
    ctx.beginPath();
    ctx.roundRect(0,0,size,size,+radius.value);
    ctx.clip();
  }

  ctx.fillStyle=bgFill.value;
  ctx.fillRect(0,0,size,size);

  if(+shadowBlur.value>0){
    ctx.shadowColor=`rgba(0,0,0,${shadowOpacity.value})`;
    ctx.shadowBlur=+shadowBlur.value;
    ctx.shadowOffsetX=+shadowX.value;
    ctx.shadowOffsetY=+shadowY.value;
  }

  ctx.drawImage(temp,x,y,nw,nh);

  ctx.shadowBlur=0;

  if(applyOutline.checked && +outlineWidth.value>0){
    ctx.lineWidth=+outlineWidth.value;
    ctx.strokeStyle=outlineColor.value;
    ctx.strokeRect(x,y,nw,nh);
  }

  if(+glowRadius.value>0){
    ctx.shadowColor=glowColor.value;
    ctx.shadowBlur=+glowRadius.value;
    ctx.drawImage(temp,x,y,nw,nh);
  }

  if(rainbow.checked){
    const grad=ctx.createLinearGradient(0,0,size,size);
    grad.addColorStop(0,"red");
    grad.addColorStop(.2,"orange");
    grad.addColorStop(.4,"yellow");
    grad.addColorStop(.6,"green");
    grad.addColorStop(.8,"blue");
    grad.addColorStop(1,"purple");
    ctx.globalCompositeOperation="overlay";
    ctx.fillStyle=grad;
    ctx.fillRect(0,0,size,size);
    ctx.globalCompositeOperation="source-over";
  }

  ctx.restore();
}

document.getElementById("download").onclick=()=>{
  const sizes=[128,256,512,1024];
  items.forEach(item=>{
    sizes.forEach(s=>{
      const a=document.createElement("a");
      a.href=item.canvas.toDataURL("image/png");
      a.download=`Icon_${s}.png`;
      a.click();
    });
  });
};
</script>
</body>
</html>
